# 规划模型

我们来系统地梳理一下**规划类问题**的常见知识与模型。这是运筹学（Operations Research）中最核心、应用最广泛的一个分支，其本质就是**在有限的资源和约束下，做出最优的决策**。

你可以把所有规划问题都想象成是在**“戴着镣铐跳舞”**：
*   **“舞”**：你的**目标 (Objective)**，比如跳得最高（利润最大化）、最稳（成本最小化）、最优美（效率最高）。
*   **“镣铐”**：你必须遵守的**约束条件 (Constraints)**，比如舞台不能超出、体力有限、时间有限。

规划模型的任务，就是找到一种跳舞的方式，既不挣脱镣铐，又能把舞跳得最好。

---

## 一、 规划模型的“三要素”

任何一个规划问题，都可以被三个核心要素来定义：

1.  **决策变量 (Decision Variables)**：
    *   **是什么？** 模型中那些我们**可以控制和改变**的量。它们是问题的“答案”所在。
    *   **例子**：生产多少件A产品、多少件B产品？每个工厂应该分配多少任务？资金应该如何投资在股票A、B、C上？是否要修建这个仓库（是/否）？

2.  **目标函数 (Objective Function)**：
    *   **是什么？** 一个用来**衡量决策好坏**的数学表达式。它通常是决策变量的函数。
    *   **目标**：要么是**最大化 (Maximize)**，要么是**最小化 (Minimize)**。
    *   **例子**：`Maximize 3x + 5y` (最大化总利润，其中x和y是两种产品的产量)；`Minimize 10a + 12b + 8c` (最小化总成本)。

3.  **约束条件 (Constraints)**：
    *   **是什么？** 一系列用来**限制决策变量取值范围**的等式或不等式。它们代表了现实世界中的各种限制，如资源、时间、法规、物理定律等。
    *   **例子**：
        *   `2x + y <= 100` (原材料A的总用量不能超过100个单位)
        *   `x + 3y <= 120` (工时总用量不能超过120小时)
        *   `x >= 0, y >= 0` (产量不能为负，这是最常见的非负约束)
        *   `z ∈ {0, 1}` (z是一个二进制变量，代表“是/否”决策)

---

## 二、 常见规划模型“家族”

根据这三要素的数学形式，规划模型可以被划分为一个清晰的“家族树”，从简单到复杂：

#### 1. **线性规划 (Linear Programming, LP)** - 家族的基石

*   **定义**：目标函数和所有约束条件**都是**决策变量的**线性**表达式。
*   **特点**：
    *   这是最简单、最成熟、应用最广泛的一类规划问题。
    *   解的性质非常好：如果存在最优解，它一定在可行域（所有约束条件围成的一个多边形/多面体）的**顶点**上取到。
*   **经典算法**：**单纯形法 (Simplex Method)**、内点法。
*   **经典问题**：
    *   **生产计划问题**：如何在有限的资源下，安排多种产品的生产以最大化利润？
    *   **配料问题 (Diet Problem)**：如何用最少的成本，混合多种原料来满足一系列营养成分的要求？
    *   **运输问题**：如何安排从多个仓库到多个零售点的货物运输，以最小化总运输成本？

#### 2. **整数规划 (Integer Programming, IP)** - 决策必须是整数

*   **定义**：在线性规划的基础上，增加了部分或全部决策变量**必须是整数**的约束。
*   **子类别**：
    *   **纯整数规划 (Pure IP)**：所有决策变量都是整数。
    *   **混合整数规划 (Mixed-Integer Programming, MIP)**：部分决策变量是整数，部分是连续变量。
    *   **0-1规划 / 二进制规划 (Binary Programming)**：决策变量只能取0或1，通常用于表示“是/否”、“选择/不选择”的决策。
*   **特点**：比线性规划**难解得多**！因为可行解不再是连续的多面体，而是一堆离散的点，单纯形法不再适用。
*   **经典算法**：**分支定界法 (Branch and Bound)**、割平面法。
*   **经典问题**：
    *   **背包问题 (Knapsack Problem)**：一个背包有固定容量，如何选择最有价值的几件物品放入，而不超过容量？（典型的0-1规划）
    *   **选址问题 (Facility Location Problem)**：在多个候选地点中，选择几个地点建立仓库或工厂，以最小化建设和运输总成本。
    *   **任务分配问题**：将N个任务分配给N个工人，每个工人完成不同任务的成本不同，如何分配使得总成本最低？

#### 3. **非线性规划 (Non-Linear Programming, NLP)** - 关系是弯曲的

*   **定义**：目标函数或至少一个约束条件中，包含了决策变量的**非线性**项（如平方项 `x²`、乘积项 `xy`、指数项 `e^x` 等）。
*   **特点**：
    *   复杂度极高，解的性质非常复杂。
    *   可能会有**多个局部最优解**，找到全局最优解非常困难。
*   **子类别**：
    *   **凸规划 (Convex Programming)**：如果目标函数是凸函数（求最小化）或凹函数（求最大化），且可行域是凸集，那么局部最优解就是全局最优解。这是非线性规划中“最好”的一类。
*   **经典算法**：梯度下降法、牛顿法、序列二次规划 (SQP) 等。
*   **经典问题**：
    *   **投资组合优化 (Portfolio Optimization)**：在金融领域，风险（方差）通常是投资比例的二次函数，目标是在给定风险下最大化收益，或在给定收益下最小化风险。
    *   **定价问题**：`收益 = 价格 * 销量(价格)`，如果销量是价格的线性函数 `销量 = a - b*价格`，那么收益就是 `价格 * (a - b*价格) = a*价格 - b*价格²`，这是一个二次函数，因此是**非线性规划**。

#### 4. **动态规划 (Dynamic Programming, DP)** - 多阶段决策的智慧

*   **定义**：将一个复杂的大问题，分解成一系列相互关联的、更小的**子问题（阶段）**，然后从最后一个阶段开始，**倒序**求解每个阶段的最优决策，最终得到整个问题的最优解。
*   **核心思想**：**最优性原理**（一个最优策略的子策略也必须是最优的）和**无后效性**（未来的决策只受当前状态影响，与如何到达当前状态无关）。
*   **特点**：不是一种具体的模型，而是一种**解决问题的思想和方法**。
*   **经典问题**：
    *   **最短路径问题**：从起点到终点，经过多个中间城市，如何选择路径使得总距离最短？
    *   **资源分配问题**：将有限的资源（如资金、设备）分配给多个项目，以最大化总回报。
    *   **背包问题**：也可以用动态规划来求解。

#### 5. **随机规划 / 鲁棒优化** - 应对不确定性

*   **定义**：处理那些模型参数（如市场需求、成本、收益）本身是**随机变量**或在一定范围内**不确定**的规划问题。
*   **思想**：
    *   **随机规划**：目标通常是最大化**期望**收益，或在一定概率下满足某些约束。
    *   **鲁棒优化**：寻找一个在**所有可能的最坏情况**下，表现仍然最好的决策。
*   **应用场景**：供应链管理（需求不确定）、金融投资（市场收益不确定）、能源系统规划（风能、太阳能发电量不确定）。

### 总结

| 模型类型              | 决策变量  | 目标函数 & 约束 | 核心特点               | 经典问题           |
| :-------------------- | :-------- | :-------------- | :--------------------- | :----------------- |
| **线性规划 (LP)**     | 连续      | 线性            | 简单、成熟、高效       | 生产计划、运输     |
| **整数规划 (IP/MIP)** | 整数/混合 | 线性            | 离散决策，计算复杂     | 选址、背包、分配   |
| **非线性规划 (NLP)**  | 连续      | 非线性          | 复杂，可能多局部最优解 | 投资组合、定价     |
| **动态规划 (DP)**     | 任意      | 任意            | 多阶段、倒序求解       | 最短路径、资源分配 |

在解决实际问题时，我们往往需要**组合使用**这些模型。例如，用时间序列**预测**未来的需求（一个不确定参数），然后将这个预测值代入一个**混合整数非线性规划**模型中，来求解最优的补货和定价**决策**。

## 三、数模典型规划模型

### 第一梯队：核心中的核心，几乎每年必考

#### **1. 线性规划 (Linear Programming, LP) 及其变体**

*   **为什么是第一？**
    *   **万物皆可线性化**：线性规划是所有规划模型的基础。更重要的是，许多看似复杂的非线性问题，在经过合理的**简化、假设或分段近似**后，都可以被转化成线性规划问题来求解。这种“线性化”的能力是数模中的一项关键技能。
    *   **求解高效可靠**：有非常成熟、快速的求解器（如 `scipy.linprog`, Gurobi, LINGO），可以在几秒钟内解决成千上万个变量的问题，让你能快速验证模型。
*   **在比赛中的典型应用**：
    *   **资源分配/生产计划**：这是最经典的应用。比如，工厂有A、B、C三种机器，每种机器有固定的工时；要生产甲、乙、丙三种产品，每种产品在不同机器上耗时不同，利润也不同。问如何安排生产，使得总利润最大？
    *   **运输/物流网络优化**：多个发货点，多个收货点，每个点有供需量，每条运输路径有成本和容量限制。问如何规划运输路线，使得总成本最低？（这是经典的**运输问题**和**最小费用流**问题，都是LP的特例）。
    *   **投资组合（简化版）**：假设有多种投资品，已知其预期收益率和风险等级（被简化为线性约束），在总投资额和风险水平限制下，如何分配资金以最大化总收益？

---

### 第二梯队：问题的关键，决定模型层次

#### **2. 混合整数规划 (Mixed-Integer Programming, MIP)，特别是0-1规划**

*   **为什么是第二？**
    *   **引入“决策”**：纯粹的LP只能回答“做多少”的问题，而MIP能够回答**“做不做”**、**“选不选”**、**“是不是”**这类离散的逻辑决策。这大大扩展了模型的表达能力，使其能够刻画更复杂的现实世界。
    *   **逻辑约束的利器**：0-1变量是建模的“瑞士军刀”。例如，可以用 `y=1` 表示“仓库A被选中”，`y=0` 表示“未被选中”；或者用来表示“如果任务i分配给工人j，则 `x_ij=1`，否则为0”。
*   **在比赛中的典型应用**：
    *   **选址问题**：在 `M` 个候选城市中选择 `N` 个地点建立配送中心，并决定每个配送中心服务哪些客户，目标是最小化建设成本和运输成本之和。
    *   **调度/排班问题**：安排公交车/飞机的班次，或者为医院/呼叫中心的员工排班。决策变量通常是“某辆车/某个人在某时段是否工作”，是典型的0-1变量。
    *   **背包问题及其变种**：比如上一题的蔬菜补货，决定**哪些单品**被选中补货（0-1决策），同时决定每个被选中单品的**具体补货量**（连续决策），这就是一个混合整数规划。
    *   **带固定成本的问题**：比如，生产一种产品的成本包括一个固定的“开机费”和一个与产量相关的可变成本。这时就需要用0-1变量来表示“是否开机”。

---

### 第三梯队：进阶模型，用于处理更复杂的现实关系

#### **3. 动态规划 (Dynamic Programming, DP)**

*   **为什么是第三？**
    *   **多阶段决策**：许多问题天然地具有时间或空间的阶段性，需要做出一系列的决策。DP提供了一种系统性的、从后往前递推求解最优策略的方法。
    *   **思想深刻**：DP的核心思想——最优子结构和重叠子问题——非常强大，不仅能解决规划问题，也是很多计算机算法的理论基础。
*   **在比赛中的典型应用**：
    *   **最短路径/路线规划**：一个旅行者要从城市A到城市Z，中间必须经过B、C、D三个区域，每个区域内有多个城市可选。问如何规划路线使得总路程最短？
    *   **资源分配（多阶段）**：要把一笔资金分阶段地投资到多个项目中，每个项目在不同阶段的投入和产出不同。问如何制定投资策略，使得最终总回报最大？
    *   **库存管理**：一个商店需要为未来12个月制定订货计划。已知每个月的预测需求、订货成本和库存持有成本，问每个月应该订多少货，才能在满足需求的前提下，使得总成本最低？

#### **4. 非线性规划 (Non-Linear Programming, NLP)**

*   **为什么是第四？**
    *   **更贴近现实**：现实世界中，很多关系都不是线性的。比如，规模效应（成本不会随产量线性增加）、价格弹性（价格和销量的关系）、物理定律（如面积、体积计算）等，都需要用非线性函数来描述。
    *   **难度与风险**：NLP的求解比LP和MIP要困难得多，容易陷入局部最优。在比赛中，除非问题的核心机制是明显非线性的，否则大家更倾向于将其线性化处理。
*   **在比赛中的典型应用**：
    *   **定价问题**：如蔬菜补货问题2，`收益 = 价格 * 销量(价格)`，目标函数中出现了决策变量的乘积或平方项。
    *   **设施布局优化**：在二维平面上放置几个设施点，目标是最小化所有客户点到其最近设施点的**距离之和**。距离的计算（欧氏距离） `sqrt((x1-x2)² + (y1-y2)²) `是高度非线性的。
    *   **投资组合优化（标准版）**：马科维茨的均值-方差模型，风险（方差）是投资权重的二次函数，这是一个经典的**二次规划 (Quadratic Programming, QP)** 问题，是NLP的一个特例。

### 总结：比赛中的“黄金组合拳”

在数模竞赛中，你最常打出的组合拳往往是：

1.  **基础框架**：用**线性规划**或**混合整数规划**搭建起整个问题的骨架。
2.  **关键参数**：模型中的关键参数（如市场需求、成本、效率等）通常不是已知的，你需要用**时间序列分析（ARIMA/Prophet）、灰色预测、回归分析**等预测模型来**估计**它们。
3.  **最终求解**：将预测出的参数**代入**你建立的规划模型中，然后调用求解器（Solver）得到最终的决策方案。

所以，一个优秀的数模论文，往往是**“预测模型” + “优化模型（规划）”**的完美结合。而在这其中，**LP和MIP**无疑是规划模型部分最不可或缺的“顶梁柱”。